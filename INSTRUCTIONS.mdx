# Dynamic Rendering - Cookies - Headers - Fetch

### 💡 Dynamic Rendering - Cookies - Headers - Fetch

## 📝 Tes notes

Détaille ce que tu as appris ici, sur une page [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Nous allons aborder 3 autres manières de rendre nos `RSC` Dynamiques.

- Via l’accès au headers (http)
- Via l’accès aux cookies (http)
- Via `Fetch` (option)

Pour accéder aux Headers Http :

```tsx
import {headers} from 'next/headers'
...
const headersList = headers()
const referer = headersList.get('referer')
```

📑 Le lien vers la doc [https://nextjs.org/docs/app/api-reference/functions/cookies](https://nextjs.org/docs/app/api-reference/functions/cookies)

Pour accéder aux Cookies :

```tsx
import {cookies} from 'next/headers'
...
const cookieStore = cookies()
```

📑 Le lien vers la doc [https://nextjs.org/docs/app/api-reference/functions/headers](https://nextjs.org/docs/app/api-reference/functions/headers)

## Exercice

👨‍✈️ Hugo, le chef de projet, nous informe que nous allons devoir filtrer les `posts` aux personnes qui sont connectées uniquement (qui ont un `cookies` avec `userid`).

Pour simuler les cookies tu peux aller dans Chrome / Inspecter / Application / Cookies et ajouter un cookie

![Untitled](/course/Untitled.png)

```tsx
[Set cookies](/course/cookies.png)
```

- 🐶 Adapte le composant actuel qui a un rendu statique en rendu dynamique en vérifiant la présence des cookies
- Si pas de cookies `userid`—> pas de `post`
- Si cookies `userid`—> affichage des `posts`

Fichiers

- `/exercises/dynamic-rendering/cookies-headers/page.tsx`

## Bonus

### 1. 🚀 Rendu Dynamique avec Headers

👨‍✈️ Hugo, le chef de projet, te demande une règle un peu spéciale. Il te demande de ne pas afficher de `post` sur une version particulière du navigateur en se basant sur le `user-agent`. Tu peux retrouver les valeurs dans la requête HTTP

![Untitled](/course/Untitled1.png)

```tsx
[Set cookies](/course/useragent.png)
```

Pour filtrer la version 126, tu peux par exemple faire :

```tsx
!userAgent?.includes('Chrome/126.0.0.0')
```

🐶 Adapte le code pour filtrer ta version de navigateur

- Si pas ta version —> pas de `post`
- Si autres versions —> affichage des `posts`

Fichiers

- `/exercises/dynamic-rendering/cookies-headers/page.tsx`

### 2. 🚀 Fetch

[L’API Fetch](https://developer.mozilla.org/fr/docs/Web/API/Fetch_API/Using_Fetch) a des options pour garder les données en cache. (Mais il s’agit de la mémoire cache du navigateur)

[Next étends](https://nextjs.org/docs/app/api-reference/functions/fetch) l’[api Fetch](https://developer.mozilla.org/fr/docs/Web/API/Fetch_API/Using_Fetch) permet de récupérer les données distantes et gérer les données en cache mais côté serveur.

```tsx
export default async function Page() {
  // This request should be cached until manually invalidated.
  // Similar to `getStaticProps`.
  // `force-cache` is the default and can be omitted.
  const staticData = await fetch(`https://...`, {cache: 'force-cache'})

  // This request should be refetched on every request.
  // Similar to `getServerSideProps`.
  const dynamicData = await fetch(`https://...`, {cache: 'no-store'})

  // This request should be cached with a lifetime of 10 seconds.
  // Similar to `getStaticProps` with the `revalidate` option.
  const revalidatedData = await fetch(`https://...`, {
    next: {revalidate: 10},
  })

  return <div>...</div>
}
```

<aside>
💡 Depuis Next 15.0.0 : Default cache option was changed from `'force-cache'` to `'no-store’`

</aside>

Dans cet exercice bonus, supprime l’appel à `getPosts` et remplace le par un `fetch`

```tsx
const data = await fetch('https://jsonplaceholder.typicode.com/posts', ...
//pense a tester les otions pour faire un rendu statique et dynamique
const posts = await data.json()
```

Constate lors de la compilation le changement de mode de rendu ƒ :

```tsx
├ ƒ /exercises/dynamic-rendering/cookies-headers  154 B          88.5 kB
├ ○ /exercises/static-rendering                   154 B          88.5 kB
+ First Load JS shared by all                     88.4 kB
  ├ chunks/162-85a026428100bb9c.js                32.1 kB
  ├ chunks/92b01630-b398710d6ee562b5.js           54.4 kB
  └ other shared chunks (total)                   1.86 kB

○  (Static)   prerendered as static content
●  (SSG)      prerendered as static HTML (uses getStaticProps)
ƒ  (Dynamic)  server-rendered on demand
```

Fichiers

- `/exercises/dynamic-rendering/cookies-headers/page.tsx`

## Aller plus loin

📑 Le lien vers la doc [https://nextjs.org/docs/app/building-your-application/rendering/server-components#dynamic-functions](https://nextjs.org/docs/app/building-your-application/rendering/server-components#dynamic-functions)

## Ils vont t’aider

- **🐶 Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **🤖 Ash le Robot** : _Ash le Robot te donnera du code utile._
- **🚀 Julia La roquette** : _Julia te donnera des défis supplémentaires._
- **⛏️ Hulk le Marteau** : _Quand du code à supprimer est présent_
- **👨‍✈️ Hugo le chef de projet** : _Va t'aider sur les spécifications du projet_

## 🐜 Feedback

Remplir le formulaire le [formulaire de FeedBack](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20PRO&entry.1430994900=04%20Rendering%20Avancée&entry.533578441=03%20dynamic-rendering-cookies).
